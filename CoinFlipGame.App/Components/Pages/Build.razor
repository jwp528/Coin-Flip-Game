@page "/build"
@using CoinFlipGame.App.Models
@using CoinFlipGame.App.Models.Unlocks
@using CoinFlipGame.App.Services
@using Microsoft.JSInterop

<HeadContent>
    <title>Build-A-Boi - Coin Builder</title>
</HeadContent>

<div class="buildaboi-luxury-container">
    <!-- Header -->
    <div class="buildaboi-luxury-header">
        <div class="luxury-logo">
            <i class="bi bi-gem logo-icon"></i>
            <h1 class="luxury-title">Build-A-Boi</h1>
        </div>
        <p class="luxury-subtitle">Coin Craftsman</p>
        
        <!-- Header Actions -->
        <div class="header-actions">
            <button class="btn-felt-control" @onclick="ShowValidationGuide" title="Show validation rules">
                <i class="bi bi-book"></i>
                <span>Validation Rules</span>
            </button>
            <button class="btn-felt-control" @onclick="ClearCacheAndReload" disabled="@isClearingCache" title="Clear cache and reload">
                @if (isClearingCache)
                {
                    <span class="spinner-border-sm"></span>
                }
                else
                {
                    <i class="bi bi-arrow-repeat"></i>
                    <span>Refresh</span>
                }
            </button>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="buildaboi-workspace">
        <!-- Centered Coin Display Hero -->
        <div class="coin-display-hero">
            @if (selectedCoin != null)
            {
                <div class="coin-hero-section">
                    <!-- Large Coin Display -->
                    <div class="coin-pedestal-large">
                        <img src="@selectedCoin.Path" alt="@selectedCoin.DisplayName" class="hero-coin" />
                        <div class="coin-glow"></div>
                    </div>
                    <h2 class="coin-hero-name">@selectedCoin.DisplayName</h2>
                    @if (selectedCoin.UnlockCondition != null || selectedCoin.Effect != null)
                    {
                        <div class="coin-status-badges">
                            @if (selectedCoin.UnlockCondition != null)
                            {
                                <span class="status-badge unlock-badge">
                                    <i class="bi bi-unlock-fill"></i>
                                    <span>@selectedCoin.UnlockCondition.Type</span>
                                </span>
                            }
                            @if (selectedCoin.Effect != null)
                            {
                                <span class="status-badge effect-badge">
                                    <i class="bi bi-magic"></i>
                                    <span>@selectedCoin.Effect.Type</span>
                                </span>
                            }
                        </div>
                    }
                    
                    <!-- Configuration Tabs/Sections -->
                    <div class="hero-config-container">
                        <!-- Unlock Condition Section -->
                        <div class="hero-config-section">
                            <div class="hero-section-header">
                                <i class="bi bi-unlock-fill"></i>
                                <h3>Unlock Condition</h3>
                            </div>
                            <div class="hero-section-content">
                                <div class="config-row">
                                    <div class="config-field config-field-flex-2">
                                        <i class="bi bi-gear-fill field-icon"></i>
                                        <select class="inline-select" @bind="mainCondition.Type">
                                            @foreach (var type in Enum.GetValues<UnlockConditionType>())
                                            {
                                                <option value="@type">@type</option>
                                            }
                                        </select>
                                    </div>
                                    @if (mainCondition.Type != UnlockConditionType.None)
                                    {
                                        <div class="config-field config-field-flex-1">
                                            <i class="bi bi-star field-icon"></i>
                                            <select class="inline-select" @bind="mainCondition.Rarity">
                                                @foreach (var rarity in Enum.GetValues<UnlockRarity>())
                                                {
                                                    <option value="@rarity">@rarity</option>
                                                }
                                            </select>
                                        </div>
                                    }
                                </div>

                                @if (mainCondition.Type != UnlockConditionType.None)
                                {
                                    <div class="config-row">
                                        <div class="config-field config-field-full">
                                            <i class="bi bi-text-left field-icon"></i>
                                            <input type="text" class="inline-input" @bind="mainCondition.Description" placeholder="Description..." />
                                        </div>
                                    </div>

                                    @switch (mainCondition.Type)
                                    {
                                        case UnlockConditionType.TotalFlips:
                                        case UnlockConditionType.HeadsFlips:
                                        case UnlockConditionType.TailsFlips:
                                            <div class="luxury-form-group">
                                                <label class="luxury-label">Required Count</label>
                                                <input type="number" class="luxury-input" @bind="mainCondition.RequiredCount" min="1" />
                                            </div>
                                            break;

                                        case UnlockConditionType.Streak:
                                            <div class="luxury-form-group">
                                                <label class="luxury-label">Required Streak Length</label>
                                                <input type="number" class="luxury-input" @bind="mainCondition.RequiredCount" min="1" />
                                            </div>
                                            <div class="luxury-form-group">
                                                <label class="luxury-label">Streak Side</label>
                                                <select class="luxury-select" @bind="streakSideSelection">
                                                    <option value="Any">Any Side</option>
                                                    <option value="Heads">Heads Only</option>
                                                    <option value="Tails">Tails Only</option>
                                                </select>
                                            </div>
                                            break;

                                        case UnlockConditionType.LandOnCoin:
                                            <div class="luxury-form-group">
                                                <label class="luxury-label">Required Coin</label>
                                                <div class="luxury-coin-picker" @onclick="() => OpenRequiredCoinSelector(null)">
                                                    @if (!string.IsNullOrEmpty(mainCondition.RequiredCoinPath))
                                                    {
                                                        <img src="@mainCondition.RequiredCoinPath" alt="Required Coin" class="picker-coin-preview" />
                                                        <span>@GetCoinNameFromPath(mainCondition.RequiredCoinPath)</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="picker-placeholder">Select coin</span>
                                                    }
                                                </div>
                                            </div>
                                            <div class="luxury-form-group">
                                                <label class="luxury-label">Times Required</label>
                                                <input type="number" class="luxury-input" @bind="mainCondition.RequiredCount" min="1" />
                                            </div>
                                            break;

                                        case UnlockConditionType.RandomChance:
                                            <div class="luxury-form-group">
                                                <label class="luxury-label">Unlock Chance (%)</label>
                                                <input type="number" class="luxury-input" @bind="unlockChancePercent" min="0.001" max="100" step="0.001" />
                                                <small class="luxury-hint">Decimal: @(mainCondition.UnlockChance.ToString("F5"))</small>
                                            </div>
                                            <div class="luxury-checkbox-group">
                                                <label class="luxury-checkbox-label">
                                                    <input type="checkbox" @bind="mainCondition.RequiresActiveCoin" />
                                                    <span class="checkbox-text">Requires Active Coin</span>
                                                </label>
                                            </div>
                                            @if (mainCondition.RequiresActiveCoin)
                                            {
                                                <div class="luxury-form-group">
                                                    <label class="luxury-label">Required Active Coin</label>
                                                    <div class="luxury-coin-picker" @onclick="() => OpenRequiredCoinSelector(null)">
                                                        @if (!string.IsNullOrEmpty(mainCondition.RequiredCoinPath))
                                                        {
                                                            <img src="@mainCondition.RequiredCoinPath" alt="Required Coin" class="picker-coin-preview" />
                                                            <span>@GetCoinNameFromPath(mainCondition.RequiredCoinPath)</span>
                                                        }
                                                        else
                                                        {
                                                            <span class="picker-placeholder">Select coin</span>
                                                        }
                                                    </div>
                                                </div>
                                            }
                                            break;

                                        case UnlockConditionType.LandOnMultipleCoins:
                                            <div class="luxury-form-group">
                                                <label class="luxury-label">Required Count (per coin)</label>
                                                <input type="number" class="luxury-input" @bind="mainCondition.RequiredCount" min="1" />
                                            </div>
                                            <div class="luxury-checkbox-group">
                                                <label class="luxury-checkbox-label">
                                                    <input type="checkbox" @bind="mainCondition.UseDynamicCoinList" />
                                                    <span class="checkbox-text">Use Dynamic Coin List</span>
                                                </label>
                                            </div>
                                            @if (!mainCondition.UseDynamicCoinList)
                                            {
                                                <div class="luxury-form-group">
                                                    <label class="luxury-label">Required Coins</label>
                                                    <button class="luxury-btn-secondary" @onclick="AddRequiredCoin">+ Add Coin</button>
                                                    @if (mainCondition.RequiredCoinPaths != null && mainCondition.RequiredCoinPaths.Any())
                                                    {
                                                        <div class="coin-gallery-container">
                                                            @for (int i = 0; i < mainCondition.RequiredCoinPaths.Count; i++)
                                                            {
                                                                var index = i;
                                                                var path = mainCondition.RequiredCoinPaths[i];
                                                                <div class="coin-gallery-item" title="@GetCoinNameFromPath(path)">
                                                                    <img src="@path" alt="@GetCoinNameFromPath(path)" class="coin-gallery-img" />
                                                                    <button class="coin-gallery-remove" @onclick="() => RemoveRequiredCoin(index)" title="Remove">×</button>
                                                                </div>
                                                            }
                                                        </div>
                                                    }
                                                </div>
                                            }
                                            break;

                                        case UnlockConditionType.LandOnCoinsWithCharacteristics:
                                            <div class="luxury-form-group">
                                                <label class="luxury-label">Consecutive Count</label>
                                                <input type="number" class="luxury-input" @bind="mainCondition.ConsecutiveCount" min="1" />
                                                <small class="luxury-hint">Number of times to land on matching coins in a row</small>
                                            </div>
                                            
                                            <div class="luxury-form-group">
                                                <label class="luxury-label">Characteristic Filter</label>
                                                <select class="luxury-select" @bind="mainCondition.CharacteristicFilter">
                                                    @foreach (var filter in Enum.GetValues<CoinCharacteristicFilter>())
                                                    {
                                                        <option value="@filter">@GetCharacteristicFilterDisplayName(filter)</option>
                                                    }
                                                </select>
                                            </div>
                                            
                                            @switch (mainCondition.CharacteristicFilter)
                                            {
                                                case CoinCharacteristicFilter.SpecificCoins:
                                                    <div class="luxury-form-group">
                                                        <label class="luxury-label">Required Coins</label>
                                                        <button class="luxury-btn-secondary" @onclick="AddRequiredCoin">+ Add Coin</button>
                                                        @if (mainCondition.RequiredCoinPaths != null && mainCondition.RequiredCoinPaths.Any())
                                                        {
                                                            <div class="coin-gallery-container">
                                                                @for (int i = 0; i < mainCondition.RequiredCoinPaths.Count; i++)
                                                                {
                                                                    var index = i;
                                                                    var path = mainCondition.RequiredCoinPaths[i];
                                                                    <div class="coin-gallery-item" title="@GetCoinNameFromPath(path)">
                                                                        <img src="@path" alt="@GetCoinNameFromPath(path)" class="coin-gallery-img" />
                                                                        <button class="coin-gallery-remove" @onclick="() => RemoveRequiredCoin(index)" title="Remove">×</button>
                                                                    </div>
                                                                }
                                                            </div>
                                                        }
                                                    </div>
                                                    break;
                                                    
                                                case CoinCharacteristicFilter.UnlockConditionType:
                                                    <div class="luxury-form-group">
                                                        <label class="luxury-label">Unlock Condition Type</label>
                                                        <select class="luxury-select" @bind="mainCondition.FilterUnlockConditionType">
                                                            @foreach (var type in Enum.GetValues<UnlockConditionType>().Where(t => t != UnlockConditionType.None))
                                                            {
                                                                <option value="@type">@type</option>
                                                            }
                                                        </select>
                                                    </div>
                                                    break;
                                                    
                                                case CoinCharacteristicFilter.EffectType:
                                                    <div class="luxury-form-group">
                                                        <label class="luxury-label">Effect Type</label>
                                                        <select class="luxury-select" @bind="mainCondition.FilterEffectType">
                                                            @foreach (var type in Enum.GetValues<CoinEffectType>().Where(t => t != CoinEffectType.None))
                                                            {
                                                                <option value="@type">@type</option>
                                                            }
                                                        </select>
                                                    </div>
                                                    break;
                                                    
                                                case CoinCharacteristicFilter.PrerequisiteCountEquals:
                                                case CoinCharacteristicFilter.PrerequisiteCountGreaterThan:
                                                case CoinCharacteristicFilter.PrerequisiteCountLessThan:
                                                    <div class="luxury-form-group">
                                                        <label class="luxury-label">Prerequisite Count</label>
                                                        <input type="number" class="luxury-input" @bind="mainCondition.FilterPrerequisiteCount" min="0" />
                                                    </div>
                                                    break;
                                            }
                                            
                                            <div class="luxury-form-group">
                                                <label class="luxury-label">Side Requirement</label>
                                                <select class="luxury-select" @bind="mainCondition.SideRequirement">
                                                    @foreach (var side in Enum.GetValues<SideRequirement>())
                                                    {
                                                        <option value="@side">@GetSideRequirementDisplayName(side)</option>
                                                    }
                                                </select>
                                                <small class="luxury-hint">@GetSideRequirementHint(mainCondition.SideRequirement)</small>
                                            </div>
                                            
                                            <div class="luxury-checkbox-group">
                                                <label class="luxury-checkbox-label">
                                                    <input type="checkbox" @bind="mainCondition.RequiresActiveCoin" />
                                                    <span class="checkbox-text">Requires Specific Active Coin</span>
                                                </label>
                                            </div>
                                            
                                            @if (mainCondition.RequiresActiveCoin)
                                            {
                                                <div class="luxury-form-group">
                                                    <label class="luxury-label">Required Active Coin</label>
                                                    <div class="luxury-coin-picker" @onclick="() => OpenRequiredCoinSelector(null)">
                                                        @if (!string.IsNullOrEmpty(mainCondition.RequiredCoinPath))
                                                        {
                                                            <img src="@mainCondition.RequiredCoinPath" alt="Required Coin" class="picker-coin-preview" />
                                                            <span>@GetCoinNameFromPath(mainCondition.RequiredCoinPath)</span>
                                                        }
                                                        else
                                                        {
                                                            <span class="picker-placeholder">Select coin</span>
                                                        }
                                                    </div>
                                                    <small class="luxury-hint">The coin that must be active based on side requirement (e.g., Random.png for both sides)</small>
                                                </div>
                                            }
                                            break;
                                    }
                                }
                            </div>
                        </div>

                        <!-- Prerequisites & Effects Side by Side -->
                        <div class="hero-two-column">
                            <!-- Prerequisites Section -->
                            <div class="hero-config-section">
                                <div class="hero-section-header">
                                    <i class="bi bi-clipboard-check"></i>
                                    <h3>Prerequisites</h3>
                                </div>
                                <div class="hero-section-content">
                                    <button class="luxury-btn-secondary" @onclick="AddPrerequisite">+ Add Prerequisite</button>
                                    
                                    @if (prerequisites.Any())
                                    {
                                        <div class="prerequisites-container">
                                            @for (int i = 0; i < prerequisites.Count; i++)
                                            {
                                                var index = i;
                                                var prereq = prerequisites[i];
                                                <div class="prerequisite-card">
                                                    <div class="prereq-header">
                                                        <span class="prereq-number">#{i + 1}</span>
                                                        <button class="prereq-remove" @onclick="() => RemovePrerequisite(index)">×</button>
                                                    </div>
                                                    
                                                    <div class="luxury-form-group">
                                                        <label class="luxury-label">Type</label>
                                                        <select class="luxury-select" @bind="prereq.Type">
                                                            @foreach (var type in Enum.GetValues<UnlockConditionType>().Where(t => t != UnlockConditionType.None))
                                                            {
                                                                <option value="@type">@type</option>
                                                            }
                                                        </select>
                                                    </div>

                                                    <div class="luxury-form-group">
                                                        <label class="luxury-label">Description</label>
                                                        <input type="text" class="luxury-input" @bind="prereq.Description" />
                                                    </div>

                                                    @switch (prereq.Type)
                                                    {
                                                        case UnlockConditionType.TotalFlips:
                                                        case UnlockConditionType.HeadsFlips:
                                                        case UnlockConditionType.TailsFlips:
                                                        case UnlockConditionType.Streak:
                                                            <div class="luxury-form-group">
                                                                <label class="luxury-label">Required Count</label>
                                                                <input type="number" class="luxury-input" @bind="prereq.RequiredCount" min="1" />
                                                            </div>
                                                            break;

                                                        case UnlockConditionType.LandOnCoin:
                                                            <div class="luxury-form-group">
                                                                <label class="luxury-label">Required Coin</label>
                                                                <div class="luxury-coin-picker" @onclick="() => OpenRequiredCoinSelector(index)">
                                                                    @if (!string.IsNullOrEmpty(prereq.RequiredCoinPath))
                                                                    {
                                                                        <img src="@prereq.RequiredCoinPath" alt="Required Coin" class="picker-coin-preview" />
                                                                        <span>@GetCoinNameFromPath(prereq.RequiredCoinPath)</span>
                                                                    }
                                                                    else
                                                                    {
                                                                        <span class="picker-placeholder">Select coin</span>
                                                                    }
                                                                </div>
                                                            </div>
                                                            <div class="luxury-form-group">
                                                                <label class="luxury-label">Times Required</label>
                                                                <input type="number" class="luxury-input" @bind="prereq.RequiredCount" min="1" />
                                                            </div>
                                                            break;
                                                    }
                                                </div>
                                            }
                                        </div>
                                    }
                                </div>
                            </div>

                            <!-- Coin Effect Section -->
                            <div class="hero-config-section">
                                <div class="hero-section-header">
                                    <i class="bi bi-magic"></i>
                                    <h3>Coin Effect</h3>
                                </div>
                                <div class="hero-section-content">
                                    <div class="luxury-form-group">
                                        <label class="luxury-label">Effect Type</label>
                                        <select class="luxury-select" @bind="coinEffect.Type">
                                            @foreach (var type in Enum.GetValues<CoinEffectType>())
                                            {
                                                <option value="@type">@type</option>
                                            }
                                        </select>
                                    </div>

                                    @if (coinEffect.Type != CoinEffectType.None)
                                    {
                                        <div class="luxury-form-group">
                                            <label class="luxury-label">Effect Description</label>
                                            <input type="text" class="luxury-input" @bind="coinEffect.Description" placeholder="Enter effect description..." />
                                        </div>

                                        @switch (coinEffect.Type)
                                        {
                                            case CoinEffectType.AutoClick:
                                                <div class="luxury-form-group">
                                                    <label class="luxury-label">Auto-Click Interval (ms)</label>
                                                    <input type="number" class="luxury-input" @bind="coinEffect.AutoClickInterval" min="100" step="100" />
                                                    <small class="luxury-hint">Time between automatic flips in milliseconds (1000 = 1 second)</small>
                                                </div>
                                                break;

                                            case CoinEffectType.Weighted:
                                            case CoinEffectType.Shaved:
                                                <div class="luxury-form-group">
                                                    <label class="luxury-label">Bias Strength (%)</label>
                                                    <input type="number" class="luxury-input" @bind="biasStrengthPercent" min="0" max="100" step="1" />
                                                    <small class="luxury-hint">Decimal: @(coinEffect.BiasStrength.ToString("F3"))</small>
                                                </div>
                                                break;

                                            case CoinEffectType.Combo:
                                                <div class="luxury-form-group">
                                                    <label class="luxury-label">Combo Type</label>
                                                    <select class="luxury-select" @bind="coinEffect.ComboType">
                                                        @foreach (var type in Enum.GetValues<ComboType>())
                                                        {
                                                            <option value="@type">@type</option>
                                                        }
                                                    </select>
                                                </div>
                                                <div class="luxury-form-group">
                                                    <label class="luxury-label">@(coinEffect.ComboType == ComboType.Additive ? "Combo Modifier (Additive)" : "Combo Multiplier")</label>
                                                    <input type="number" class="luxury-input" @bind="coinEffect.ComboMultiplier" min="0" step="0.01" />
                                                    <small class="luxury-hint">
                                                        @if (coinEffect.ComboType == ComboType.Additive)
                                                        {
                                                            <text>Value added to opposite side's effect (e.g., 0.05 = +5%)</text>
                                                        }
                                                        else
                                                        {
                                                            <text>Multiplier for opposite side's effect (e.g., 1.5 = 150%)</text>
                                                        }
                                                    </small>
                                                </div>
                                                break;

                                            case CoinEffectType.Luck:
                                                <div class="luxury-form-group">
                                                    <label class="luxury-label">Luck Modifier Type</label>
                                                    <select class="luxury-select" @bind="coinEffect.LuckModifierType">
                                                        @foreach (var type in Enum.GetValues<ComboType>())
                                                        {
                                                            <option value="@type">@type</option>
                                                        }
                                                    </select>
                                                </div>
                                                <div class="luxury-form-group">
                                                    <label class="luxury-label">@(coinEffect.LuckModifierType == ComboType.Additive ? "Luck Modifier (Additive)" : "Luck Multiplier")</label>
                                                    <input type="number" class="luxury-input" @bind="coinEffect.LuckModifier" min="0" step="0.01" />
                                                    <small class="luxury-hint">
                                                        @if (coinEffect.LuckModifierType == ComboType.Additive)
                                                        {
                                                            <text>Value added to unlock chances (e.g., 0.05 = +5%)</text>
                                                        }
                                                        else
                                                        {
                                                            <text>Multiplier for unlock chances (e.g., 2.0 = 200%)</text>
                                                        }
                                                    </small>
                                                </div>
                                                break;
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Validate & Generate Button -->
                    <div class="coin-action-section">
                        <button class="luxury-btn-primary" @onclick="ValidateAndGenerate">
                            <i class="bi bi-hammer btn-icon"></i>
                            <span>Validate & Generate</span>
                        </button>

                        @if (validationErrors.Any())
                        {
                            <div class="validation-errors-luxury">
                                <div class="errors-header">
                                    <i class="bi bi-exclamation-triangle error-icon"></i>
                                    <span>Validation Errors</span>
                                </div>
                                <ul class="errors-list">
                                    @foreach (var error in validationErrors)
                                    {
                                        <li>@error</li>
                                    }
                                </ul>
                            </div>
                        }

                        @if (isValid && !string.IsNullOrEmpty(generatedCode))
                        {
                            <div class="validation-success-luxury">
                                <div class="success-header">
                                    <i class="bi bi-check-circle success-icon"></i>
                                    <span>Validation Passed!</span>
                                </div>
                                <p class="success-message">Your unlock condition is valid and ready to use.</p>
                            </div>

                            <div class="code-output-luxury">
                                <div class="code-toolbar">
                                    <span class="code-title">Generated C# Code</span>
                                    <button class="luxury-btn-copy" @onclick="CopyToClipboard">
                                        <i class="bi bi-clipboard"></i>
                                        <span>Copy</span>
                                    </button>
                                </div>
                                <pre class="code-display"><code>@generatedCode</code></pre>
                            </div>
                        }
                    </div>
                </div>
            }
            else
            {
                <div class="coin-hero-section empty">
                    <div class="empty-hero-content">
                        <i class="bi bi-coin empty-hero-icon"></i>
                        <p class="empty-hero-text">Select a coin from the collection below</p>
                        <p class="empty-hero-subtext">Choose a coin to configure its unlock conditions and effects</p>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Bottom Coin Drawer (Adapted from CoinDrawer) -->
    <div class="bottom-coin-drawer @GetDrawerClass()" @onclick="HandleDrawerBackgroundClick">
        <div class="drawer-handle-luxury" @onclick="ToggleDrawer" @onclick:stopPropagation="true">
            <div class="handle-bar-luxury"></div>
            <span class="drawer-label">@(showCoinDrawer ? "Close" : "Open") Coin Collection</span>
        </div>
        
        <div class="drawer-header-bab" @onclick:stopPropagation="true">
            <h2 class="drawer-title-bab">Select A Coin To Configure</h2>
        </div>
        
        <div class="drawer-content-luxury" @onclick:stopPropagation="true">
            <div class="drawer-inner">
                <!-- Filter Toggle -->
                <div class="drawer-filter-bar">
                    <button class="filter-btn @(showOnlyUnmapped ? "" : "active")" @onclick="ShowAllCoins">
                        <i class="bi bi-grid-3x3"></i>
                        <span>All Coins (@GetAllCoinsCount())</span>
                    </button>
                    <button class="filter-btn @(showOnlyUnmapped ? "active" : "")" @onclick="ShowUnmappedCoins">
                        <i class="bi bi-question-circle"></i>
                        <span>Unmapped (@GetUnmappedCoinsCount())</span>
                    </button>
                </div>
                
                @if (allCoinImages != null)
                {
                    <div class="coins-case-bab">
                        @foreach (var coin in GetFilteredCoins())
                        {
                            var hasConfig = coin.UnlockCondition != null || coin.Effect != null;
                            
                            <div class="coin-case-slot-bab" 
                                 @onclick="() => HandleCoinSelected(coin)" 
                                 @onmouseenter="() => HandleCoinHover(coin)">
                                <div class="coin-display-bab">
                                    <img src="@coin.Path" alt="@coin.DisplayName" class="coin-image-bab" />
                                    @if (!hasConfig)
                                    {
                                        <div class="coin-badge-new">NEW</div>
                                    }
                                </div>
                                <div class="coin-label-bab">@coin.DisplayName</div>
                            </div>
                        }
                    </div>
                    
                    @if (!GetFilteredCoins().Any())
                    {
                        <div class="empty-coins-message">
                            <i class="bi bi-inbox"></i>
                            <p>@(showOnlyUnmapped ? "All coins have been configured!" : "No coins available")</p>
                        </div>
                    }
                }
            </div>
        </div>
    </div>
</div>
