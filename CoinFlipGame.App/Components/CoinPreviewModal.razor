@using CoinFlipGame.App.Models
@using CoinFlipGame.App.Services
@using Microsoft.AspNetCore.Components.Web

<div class="coin-preview-overlay @(IsVisible ? "visible" : "")" @onclick="OnClose">
    <div class="coin-preview-modal" @onclick:stopPropagation="true">
        <button class="preview-close-btn" @onclick="OnClose">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        
        <div class="preview-content">
            <h3 class="preview-title">@CoinImage?.DisplayName</h3>
            <p class="preview-subtitle">Drag to rotate</p>
            
            @if (CoinImage != null)
            {
                <!-- Coin Stats -->
                <div class="preview-stats">
                    @if (CoinImage.UnlockCondition != null)
                    {
                        <div class="preview-stat">
                            <span class="preview-stat-icon">??</span>
                            <div class="preview-stat-content">
                                <span class="preview-stat-label">Unlock Type</span>
                                <span class="preview-stat-value">@FormatUnlockType(CoinImage.UnlockCondition.Type)</span>
                            </div>
                        </div>
                        
                        <div class="preview-stat">
                            <span class="preview-stat-icon">??</span>
                            <div class="preview-stat-content">
                                <span class="preview-stat-label">Condition</span>
                                <span class="preview-stat-value">@CoinImage.UnlockCondition.Description</span>
                            </div>
                        </div>
                        
                        <div class="preview-stat">
                            <span class="preview-stat-icon">?</span>
                            <div class="preview-stat-content">
                                <span class="preview-stat-label">Rarity</span>
                                <span class="preview-stat-value rarity-@CoinImage.UnlockCondition.Rarity.ToString().ToLower()">@CoinImage.UnlockCondition.Rarity</span>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="preview-stat">
                            <span class="preview-stat-icon">??</span>
                            <div class="preview-stat-content">
                                <span class="preview-stat-label">Availability</span>
                                <span class="preview-stat-value">Always Unlocked</span>
                            </div>
                        </div>
                    }
                    
                    @{
                        var unlockDate = UnlockProgress.GetUnlockTimestamp(CoinImage.Path);
                        if (unlockDate.HasValue)
                        {
                            <div class="preview-stat">
                                <span class="preview-stat-icon">??</span>
                                <div class="preview-stat-content">
                                    <span class="preview-stat-label">Unlocked On</span>
                                    <span class="preview-stat-value">@FormatUnlockDate(unlockDate.Value)</span>
                                </div>
                            </div>
                        }
                        
                        var timesLanded = UnlockProgress.GetCoinLandCount(CoinImage.Path);
                        <div class="preview-stat">
                            <span class="preview-stat-icon">??</span>
                            <div class="preview-stat-content">
                                <span class="preview-stat-label">Times Landed</span>
                                <span class="preview-stat-value">@timesLanded</span>
                            </div>
                        </div>
                    }
                </div>
            }
            
            <div class="preview-coin-container">
                <div class="preview-coin"
                     @ref="previewCoinElement"
                     @onpointerdown="OnPointerDown"
                     @onpointermove="OnPointerMove"
                     @onpointerup="OnPointerUp"
                     @onpointercancel="OnPointerCancel"
                     style="@GetCoinTransform()">
                    <div class="preview-coin-face">
                        <div class="preview-coin-shine" style="@GetShineTransform()"></div>
                        @if (CoinImage != null)
                        {
                            <img src="@CoinImage.Path" alt="@CoinImage.DisplayName" draggable="false" />
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
